/*! SnakeJS - v0.1.0 - 2012-08-20
* https://github.com/noweverywhere/SnakeJS
* Copyright (c) 2012 Marinus Swanepoel; Licensed MIT, GPL */
var SnakeJS=SnakeJS||{};SnakeJS.Food=function(a){var b=this,c=typeof a;return b.attr={},b.attr.defaults={type:"apple",value:1},c==="string"?this.changeType(a):c==="object"?b.attr={type:a.type||this.attr.defaults.type,value:a.value||this.attr.defaults.value}:b.attr={type:this.attr.defaults.type,value:this.attr.defaults.value},b},SnakeJS.Food.prototype.changeType=function(a){switch(a){case"lemon":this.attr.type="lemon",this.attr.value=2;break;case"pineapple":this.attr.type="pineapple",this.attr.value=0;break;default:this.attr.type=this.attr.defaults.type,this.attr.value=this.attr.defaults.value}};var SnakeJS={};SnakeJS.Game=function(a){var b=this;return b.attr=a||{size:{x:20,y:20,mapstyle:"canvas",steptime:100}},b.init(),b},SnakeJS.Game.prototype.render=function(){this.map.startrender()},SnakeJS.Game.prototype.init=function(){this.ticker=new SnakeJS.Ticker(this.attr.steptime),this.map=new SnakeJS.Map(this.attr.size),this.snake=new SnakeJS.Snake,this.ticker.addUpdateFunction({id:"map",func:this.map.update},{id:"snake",func:this.snake.update}),this.map.addObject(this.snake)},SnakeJS.Game.prototype.start=function(){this.ticker.start(),this.render()},SnakeJS.Game.prototype.pause=function(){this.ticker.stop()},SnakeJS.Game.prototype.stop=function(){this.ticker.stop()};var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,animationFunction;window.requestAnimationFrame=requestAnimationFrame,SnakeJS.Map=function(a){var b=this;return b.attr={size:a},b.Make(),b},SnakeJS.Map.prototype.Make=function(){var a=0,b;this.blocks={};for(a;a<this.attr.size.x;a+=1){b=0,this.blocks[a]={};for(b;b<this.attr.size.y;b+=1)this.blocks[a][b]={}}},SnakeJS.Map.prototype.Destroy=function(){this.blocks={}},SnakeJS.Map.prototype.render=function(a){},SnakeJS.Map.prototype.stoprender=function(){this.stop=!0},SnakeJS.Map.prototype.startrender=function(){var a=this,b=function(){var b=function(){a.render(),a.stop!==!0&&requestAnimationFrame(b)};return b};requestAnimationFrame?requestAnimationFrame(b()):setInterval(),this.stopRender=!1},SnakeJS.Map.prototype.addObject=function(a){!a.attr||!a.attr.x},SnakeJS.Snake=function(a){var b=this;return b.attr=a||{color:"red",length:2,speed:1,head:{x:1,y:0,targetBlock:{}},direction:"up",superpowered:!1},b},SnakeJS.Snake.prototype.update=function(){if(this.keypress)switch(this.keypress){case 38:this.attr.direction="up";break;case 39:this.attr.direction="right";break;case 40:this.attr.direction="down";break;case 37:this.attr.direction="left"}this.move()},SnakeJS.Snake.prototype.eat=function(a){this.attr.superpowered===!1&&(this.attr.length=this.attr.length+a.attr.value),a.attr.type==="pineapple"&&(this.attr.superpowered=!0)},SnakeJS.Snake.prototype.move=function(){var a=this.direction;switch(a){case"up":this.attr.head.targetBlock.y=this.attr.head.y+1,this.attr.head.targetBlock.x=this.attr.head.x;break;case"right":this.attr.head.targetBlock.y=this.attr.head.y,this.attr.head.targetBlock.x=this.attr.head.x+1;break;case"down":this.attr.head.targetBlock.y=this.attr.head.y-1,this.attr.head.targetBlock.x=this.attr.head.x;break;case"left":this.attr.head.targetBlock.y=this.attr.head.y,this.attr.head.targetBlock.x=this.attr.head.x-1}},SnakeJS.Ticker=function(a){var b=this;return b.attr={},b.attr.steptime=a,b.updateFunctions={},b},SnakeJS.Ticker.prototype.addUpdateFunction=function(){var a=0,b=arguments.length,c;for(a;a<b;a+=1)c=arguments[a],this.updateFunctions[c.id]=c.func;this.numberOfUpdateFunctions=this.updateFunctions.length},SnakeJS.Ticker.prototype.tick=function(){var a;for(a in this.updateFunctions)this.numberOfUpdateFunctions.hasOwnProperty(a)&&a()},SnakeJS.Ticker.prototype.start=function(){this.interval=setInterval(this.tick,this.attr.steptime)};